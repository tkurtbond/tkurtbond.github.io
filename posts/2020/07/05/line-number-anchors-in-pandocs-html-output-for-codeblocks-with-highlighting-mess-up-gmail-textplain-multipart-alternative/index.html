<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Line number anchors in pandoc's HTML output for codeblocks with highlighting mess up Gmail text/plain multipart alternative | Lacking Natural Simplicity</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../../rss.xml">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../../../../feed.atom">
<link rel="canonical" href="https://tkurtbond.github.io/posts/2020/07/05/line-number-anchors-in-pandocs-html-output-for-codeblocks-with-highlighting-mess-up-gmail-textplain-multipart-alternative/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="T. Kurt Bond">
<link rel="prev" href="../../04/steve-jacksons-goal-with-gurps/" title="Steve Jackson's Goal with GURPS" type="text/html">
<link rel="next" href="../../07/savage-worlds-adventure-edition-fixes-spears/" title="Savage Worlds Adventure Edition Fixes Spears" type="text/html">
<meta property="og:site_name" content="Lacking Natural Simplicity">
<meta property="og:title" content="Line number anchors in pandoc's HTML output for codeblocks with highli">
<meta property="og:url" content="https://tkurtbond.github.io/posts/2020/07/05/line-number-anchors-in-pandocs-html-output-for-codeblocks-with-highlighting-mess-up-gmail-textplain-multipart-alternative/">
<meta property="og:description" content="I’ve found that if I write something in ReStructuredText, create HTML
from it and embed a stylesheet with the proper css in the
.html file using pandoc’s --include-in-header option that
I can cut and ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-07-05T18:48:44-04:00">
<meta property="article:tag" content="gmail">
<meta property="article:tag" content="html">
<meta property="article:tag" content="pandoc">
<meta property="article:tag" content="rst">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<div class="blog-masthead">
    <div class="container">
<!-- This keeps the margins nice -->
        <nav class="blog-nav" role="navigation"><a href="../../../../../index.html" class="blog-nav-item">Home</a>
            <a href="../../../../../archive.html" class="blog-nav-item">Archives</a>
            <a href="../../../../../categories/index.html" class="blog-nav-item">Tags &amp; Categories</a>
            <a href="../../../../../rss.xml" class="blog-nav-item">RSS feed</a>
            <a href="../../../../../feed.atom" class="blog-nav-item">Atom feed</a>

            

    <a href="index.rst" class="blog-nav-item blog-nav-item-aside" id="sourcelink">Source</a>
                
            
        </nav>
</div>
<!-- /.container -->
</div>
<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <div class="blog-header">
            <h1 class="blog-title">
                <a href="https://tkurtbond.github.io/">

                    <span id="blog-title">Lacking Natural Simplicity</span>
                </a>
            </h1>
            <p class="lead blog-description">Random musings on books, code, and tabletop games.</p>
            
        </div>
        <!--Body content-->
        <div class="row">
            <div class="col-sm-8 blog-main">
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title blog-post-title" itemprop="headline name"><a href="." class="u-url">Line number anchors in pandoc's HTML output for codeblocks with highlighting mess up Gmail text/plain multipart alternative</a></h2>

        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">T. Kurt Bond</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-07-05T18:48:44-04:00" itemprop="datePublished" title="2020-07-05 18:48">2020-07-05 18:48</time></a></p>
                <p class="commentline">            <a href="#disqus_thread" data-disqus-identifier="cache/posts/2020/07/05/line-number-anchors-in-pandocs-html-output-for-codeblocks-with-highlighting-mess-up-gmail-textplain-multipart-alternative.html">Comments</a>


                    </p>
<p class="sourceline"><a href="index.rst" id="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I’ve found that if I write something in <a class="reference external" href="https://docutils.sourceforge.io/rst.html">ReStructuredText</a>, create HTML
from it and embed a stylesheet with the proper css in the
<code class="file docutils literal">.html</code> file using <a class="reference external" href="https://pandoc.org/">pandoc</a>’s <code class="docutils literal"><span class="pre">--include-in-header</span></code> option that
I can cut and paste from the web page displayed in my browser from
that HTML directly into gmail, and things like code blocks and literal
text will have the nice surrounded by a box, light gray background
formatting that carries over to <a class="reference external" href="https://www.google.com/gmail/">Gmail</a>.  That's nice because Gmail's
native formatting is a … minimalist user experience.</p>
<p>However, I've found that if I use the <code class="docutils literal">.. include::</code> directive with
the <code class="docutils literal">:code:</code> option (which basically makes it a code block) and
specify a language for highlighting with an argument to the <code class="docutils literal">:code:</code>
option that the text/html part in the resulting multipart/alternative
e-mail displays fine in Gmail (and probably other <a class="reference external" href="https://en.wikipedia.org/wiki/Email_client">mail user agent</a>s
that display the HTML part; <a class="reference external" href="http://www.mew.org/en/">Mew</a> in Emacs works too), but the
<code class="docutils literal">text/plain</code> part is messed up, with weird HTML-like tags in the
plain text. <a class="footnote-reference brackets" href="#plain-code-directive" id="id1">1</a></p>
<p>For instance, suppose I have the following RST source for the message
I want to write (<code class="file docutils literal"><span class="pre">missing-ampersand.rst</span></code>):</p>
<pre class="code restructuredtext"><a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-1" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-1"></a><span class="nc">:title:</span> Missing Ampersand in Code Blocks in <span class="s">``-ms``</span> Output
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-2" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-2"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-3" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-3"></a>Here's some ReStructuredText input that has a code block in it:
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-4" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-4"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-5" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-5"></a><span class="p">..</span> <span class="ow">include</span><span class="p">::</span> ma.rst
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-6" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-6"></a>   <span class="nc">:code:</span> restructuredtext
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-7" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-7"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-8" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-8"></a>Here's the <span class="s">``-ms``</span> output from it:
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-9" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-9"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-10" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-10"></a><span class="p">..</span> <span class="ow">include</span><span class="p">::</span> ma-rst.ms
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-11" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-11"></a>   <span class="nc">:code:</span> nroff
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-12" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-12"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-13" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-13"></a>See the first line that starts with <span class="s">``.. container::``</span>?  That line
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-14" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-14"></a>should start with <span class="s">``\&amp;``</span> so it isn't interpreted as an <span class="gs">**roff**</span>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-15" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-15"></a>command.  As it is, when you build the PDF output from output that
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-16" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-16"></a>line disappears entirely with no warning to the user.  (The default
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-17" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-17"></a>for <span class="gs">**roff**</span> processors like <span class="gs">**groff**</span> is to ignore unknown commands.)
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-18" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-18"></a>
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-19" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-19"></a>See the second line that starts with <span class="s">``.. container::``</span>?  That line
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-20" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-20"></a><span class="gs">**does**</span> start with <span class="s">``\&amp;``</span>.  It makes it through fine.  The other
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-21" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-21"></a>lines whose first non-whitespace character is <span class="s">``.``</span> make it through
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-22" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-22"></a>fine because to make it a <span class="gs">**roff**</span> command the first character on the
<a id="rest_code_4834ff5cc0fb424e977b792f666ac4ac-23" name="rest_code_4834ff5cc0fb424e977b792f666ac4ac-23"></a>line has to be a period.
</pre>
<p>where the included <a class="reference external" href="https://docutils.sourceforge.io/rst.html">ReStructuredText</a> file (<code class="file docutils literal">ma.rst</code>) is</p>
<pre class="code restructuredtext"><a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-1" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-1"></a>Missing Ampersand in Code Block -ms output
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-2" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-2"></a>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-3" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-3"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-4" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-4"></a>Here's a code block containing ReStructuredText:
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-5" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-5"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-6" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-6"></a><span class="p">..</span> <span class="ow">code</span><span class="p">::</span>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-7" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-7"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-8" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-8"></a><span class="p">   ..</span> <span class="ow">container</span><span class="p">::</span> for-format ms
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-9" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-9"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-10" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-10"></a><span class="p">      ..</span> <span class="ow">figure</span><span class="p">::</span> davesmapper-2017-04-10-caves-4-numbered.eps
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-11" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-11"></a>         <span class="nc">:alt:</span> Map of Bandit's Cave
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-12" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-12"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-13" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-13"></a>      Map of Bandit's Cave
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-14" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-14"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-15" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-15"></a><span class="p">   ..</span> <span class="ow">container</span><span class="p">::</span> for-format html latex context epub
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-16" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-16"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-17" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-17"></a><span class="p">      ..</span> <span class="ow">figure</span><span class="p">::</span> davesmapper-2017-04-10-caves-4-numbered.png
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-18" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-18"></a>         <span class="nc">:alt:</span> Map of Bandit's Cave
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-19" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-19"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-20" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-20"></a>         Map of Bandit's Cave
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-21" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-21"></a>
<a id="rest_code_715d10a3f2244a0d894b48a0e444a3af-22" name="rest_code_715d10a3f2244a0d894b48a0e444a3af-22"></a>How's that look?
</pre>
<p>and the included roff source file (<code class="file docutils literal"><span class="pre">ms-rst.ms</span></code>) is</p>
<pre class="code groff"><a id="rest_code_0728362cf85e4d21940af100f0cd9638-1" name="rest_code_0728362cf85e4d21940af100f0cd9638-1"></a>.<span class="k">SH</span> <span class="m">1</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-2" name="rest_code_0728362cf85e4d21940af100f0cd9638-2"></a>Missing Ampersand in Code Block -ms output
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-3" name="rest_code_0728362cf85e4d21940af100f0cd9638-3"></a>.<span class="k">pdfhref</span> <span class="s">O</span> <span class="m">1</span> <span class="s2">"Missing Ampersand in Code Block -ms output"</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-4" name="rest_code_0728362cf85e4d21940af100f0cd9638-4"></a>.<span class="k">pdfhref</span> <span class="s">M</span> <span class="s2">"missing-ampersand-in-code-block--ms-output"</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-5" name="rest_code_0728362cf85e4d21940af100f0cd9638-5"></a>.<span class="k">LP</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-6" name="rest_code_0728362cf85e4d21940af100f0cd9638-6"></a>Here<span class="se">\[</span>aq]s a code block containing ReStructuredText:
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-7" name="rest_code_0728362cf85e4d21940af100f0cd9638-7"></a>.<span class="k">IP</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-8" name="rest_code_0728362cf85e4d21940af100f0cd9638-8"></a>.<span class="k">nf</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-9" name="rest_code_0728362cf85e4d21940af100f0cd9638-9"></a><span class="se">\f[C]</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-10" name="rest_code_0728362cf85e4d21940af100f0cd9638-10"></a><span class="p">.</span><span class="s">.</span> <span class="s">container::</span> <span class="s">for-format</span> <span class="s">ms</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-11" name="rest_code_0728362cf85e4d21940af100f0cd9638-11"></a>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-12" name="rest_code_0728362cf85e4d21940af100f0cd9638-12"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.eps
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-13" name="rest_code_0728362cf85e4d21940af100f0cd9638-13"></a>      :alt: Map of Bandit<span class="se">\[</span>aq]s Cave
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-14" name="rest_code_0728362cf85e4d21940af100f0cd9638-14"></a>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-15" name="rest_code_0728362cf85e4d21940af100f0cd9638-15"></a>   Map of Bandit<span class="se">\[</span>aq]s Cave
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-16" name="rest_code_0728362cf85e4d21940af100f0cd9638-16"></a>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-17" name="rest_code_0728362cf85e4d21940af100f0cd9638-17"></a><span class="se">\&amp;</span>.. container:: for-format html latex context epub
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-18" name="rest_code_0728362cf85e4d21940af100f0cd9638-18"></a>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-19" name="rest_code_0728362cf85e4d21940af100f0cd9638-19"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.png
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-20" name="rest_code_0728362cf85e4d21940af100f0cd9638-20"></a>      :alt: Map of Bandit<span class="se">\[</span>aq]s Cave
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-21" name="rest_code_0728362cf85e4d21940af100f0cd9638-21"></a>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-22" name="rest_code_0728362cf85e4d21940af100f0cd9638-22"></a>      Map of Bandit<span class="se">\[</span>aq]s Cave
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-23" name="rest_code_0728362cf85e4d21940af100f0cd9638-23"></a><span class="se">\f[]</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-24" name="rest_code_0728362cf85e4d21940af100f0cd9638-24"></a>.<span class="k">fi</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-25" name="rest_code_0728362cf85e4d21940af100f0cd9638-25"></a>.<span class="k">LP</span>
<a id="rest_code_0728362cf85e4d21940af100f0cd9638-26" name="rest_code_0728362cf85e4d21940af100f0cd9638-26"></a>How<span class="se">\[</span>aq]s that look?
</pre>
<p>Then the resulting HTML output for the first code block <a class="footnote-reference brackets" href="#toolong" id="id2">2</a> is:</p>
<pre class="code html"><a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-1" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"sourceCode"</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1"</span><span class="p">&gt;&lt;</span><span class="nt">pre</span> <span class="na">class</span><span class="o">=</span><span class="s">"sourceCode restructuredtext"</span><span class="p">&gt;&lt;</span><span class="nt">code</span> <span class="na">class</span><span class="o">=</span><span class="s">"sourceCode rest"</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-1"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-1"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>Missing Ampersand in Code Block -ms output<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-2" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-2"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-2"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-2"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-3" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-3"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-3"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-3"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-4" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-4"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-4"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-4"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>Here<span class="ni">&amp;#39;</span>s a code block containing ReStructuredText:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-5" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-5"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-5"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-5"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-6" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-6"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-6"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-6"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>.. code::<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-7" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-7"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-7"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-7"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-8" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-8"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-8"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-8"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>   .. container:: for-format ms<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-9" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-9"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-9"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-9"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-10" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-10"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-10"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-10"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>      .. figure:: davesmapper-2017-04-10-caves-4-numbered.eps<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-11" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-11"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-11"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-11"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>         :alt: Map of Bandit<span class="ni">&amp;#39;</span>s Cave<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-12" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-12"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-12"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-12"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-13" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-13"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-13"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-13"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>      Map of Bandit<span class="ni">&amp;#39;</span>s Cave<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-14" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-14"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-14"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-14"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-15" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-15"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-15"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-15"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>   .. container:: for-format html latex context epub<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-16" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-16"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-16"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-16"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-17" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-17"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-17"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-17"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>      .. figure:: davesmapper-2017-04-10-caves-4-numbered.png<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-18" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-18"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-18"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-18"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>         :alt: Map of Bandit<span class="ni">&amp;#39;</span>s Cave<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-19" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-19"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-19"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-19"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-20" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-20"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-20"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-20"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"dt"</span><span class="p">&gt;</span>         Map of Bandit<span class="ni">&amp;#39;</span>s Cave<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-21" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-21"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-21"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-21"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-22" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-22"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-22"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-22"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>How<span class="ni">&amp;#39;</span>s that look?<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="rest_code_1c1017eb56a64e0ea866023da4a3338b-23" name="rest_code_1c1017eb56a64e0ea866023da4a3338b-23"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-23"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-23"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">pre</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre>
<p>And the HTML output for the second code block is:</p>
<pre class="code html"><a id="rest_code_84099815997b4a0fb3412dea989b778e-1" name="rest_code_84099815997b4a0fb3412dea989b778e-1"></a><span class="p">&lt;</span><span class="nt">pre</span> <span class="na">class</span><span class="o">=</span><span class="s">"nroff"</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>.SH 1
<a id="rest_code_84099815997b4a0fb3412dea989b778e-2" name="rest_code_84099815997b4a0fb3412dea989b778e-2"></a>Missing Ampersand in Code Block -ms output
<a id="rest_code_84099815997b4a0fb3412dea989b778e-3" name="rest_code_84099815997b4a0fb3412dea989b778e-3"></a>.pdfhref O 1 <span class="ni">&amp;quot;</span>Missing Ampersand in Code Block -ms output<span class="ni">&amp;quot;</span>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-4" name="rest_code_84099815997b4a0fb3412dea989b778e-4"></a>.pdfhref M <span class="ni">&amp;quot;</span>missing-ampersand-in-code-block--ms-output<span class="ni">&amp;quot;</span>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-5" name="rest_code_84099815997b4a0fb3412dea989b778e-5"></a>.LP
<a id="rest_code_84099815997b4a0fb3412dea989b778e-6" name="rest_code_84099815997b4a0fb3412dea989b778e-6"></a>Here\[aq]s a code block containing ReStructuredText:
<a id="rest_code_84099815997b4a0fb3412dea989b778e-7" name="rest_code_84099815997b4a0fb3412dea989b778e-7"></a>.IP
<a id="rest_code_84099815997b4a0fb3412dea989b778e-8" name="rest_code_84099815997b4a0fb3412dea989b778e-8"></a>.nf
<a id="rest_code_84099815997b4a0fb3412dea989b778e-9" name="rest_code_84099815997b4a0fb3412dea989b778e-9"></a>\f[C]
<a id="rest_code_84099815997b4a0fb3412dea989b778e-10" name="rest_code_84099815997b4a0fb3412dea989b778e-10"></a>.. container:: for-format ms
<a id="rest_code_84099815997b4a0fb3412dea989b778e-11" name="rest_code_84099815997b4a0fb3412dea989b778e-11"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-12" name="rest_code_84099815997b4a0fb3412dea989b778e-12"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.eps
<a id="rest_code_84099815997b4a0fb3412dea989b778e-13" name="rest_code_84099815997b4a0fb3412dea989b778e-13"></a>      :alt: Map of Bandit\[aq]s Cave
<a id="rest_code_84099815997b4a0fb3412dea989b778e-14" name="rest_code_84099815997b4a0fb3412dea989b778e-14"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-15" name="rest_code_84099815997b4a0fb3412dea989b778e-15"></a>   Map of Bandit\[aq]s Cave
<a id="rest_code_84099815997b4a0fb3412dea989b778e-16" name="rest_code_84099815997b4a0fb3412dea989b778e-16"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-17" name="rest_code_84099815997b4a0fb3412dea989b778e-17"></a>\<span class="ni">&amp;amp;</span>.. container:: for-format html latex context epub
<a id="rest_code_84099815997b4a0fb3412dea989b778e-18" name="rest_code_84099815997b4a0fb3412dea989b778e-18"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-19" name="rest_code_84099815997b4a0fb3412dea989b778e-19"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.png
<a id="rest_code_84099815997b4a0fb3412dea989b778e-20" name="rest_code_84099815997b4a0fb3412dea989b778e-20"></a>      :alt: Map of Bandit\[aq]s Cave
<a id="rest_code_84099815997b4a0fb3412dea989b778e-21" name="rest_code_84099815997b4a0fb3412dea989b778e-21"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-22" name="rest_code_84099815997b4a0fb3412dea989b778e-22"></a>      Map of Bandit\[aq]s Cave
<a id="rest_code_84099815997b4a0fb3412dea989b778e-23" name="rest_code_84099815997b4a0fb3412dea989b778e-23"></a>\f[]
<a id="rest_code_84099815997b4a0fb3412dea989b778e-24" name="rest_code_84099815997b4a0fb3412dea989b778e-24"></a>.fi
<a id="rest_code_84099815997b4a0fb3412dea989b778e-25" name="rest_code_84099815997b4a0fb3412dea989b778e-25"></a>.LP
<a id="rest_code_84099815997b4a0fb3412dea989b778e-26" name="rest_code_84099815997b4a0fb3412dea989b778e-26"></a>How\[aq]s that look?
<a id="rest_code_84099815997b4a0fb3412dea989b778e-27" name="rest_code_84099815997b4a0fb3412dea989b778e-27"></a>
<a id="rest_code_84099815997b4a0fb3412dea989b778e-28" name="rest_code_84099815997b4a0fb3412dea989b778e-28"></a><span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</pre>
<p>In the first code block you see a lot of HTML spans that look like this:</p>
<pre class="code html"><a id="rest_code_d6fa9351e0754dabb22b812431b28bde-1" name="rest_code_d6fa9351e0754dabb22b812431b28bde-1"></a><span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">"cb1-3"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"#cb1-3"</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>…<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre>
<p>They appear to be anchors so you can link to a particular line in the
code block.  When I displayed the HTML file in my browser (Google
Chrome), selected the text, and pasted it into the Gmail message
composition window in the message body area (except for the header
text, which I put in the Subject line text entry box instead) and it
looked fine, so I sent it.</p>
<p>But when I got a reply from someone who uses a <a class="reference external" href="https://en.wikipedia.org/wiki/Email_client">mail user agent</a>
that displays the <code class="docutils literal">text/plain</code> alternative that Gmail automatically
creates the supposedly plain text was this:</p>
<pre class="code text"><a id="rest_code_c5306145557c404cb057447834ae501b-1" name="rest_code_c5306145557c404cb057447834ae501b-1"></a>--000000000000360d1105a9a4da6e
<a id="rest_code_c5306145557c404cb057447834ae501b-2" name="rest_code_c5306145557c404cb057447834ae501b-2"></a>Content-Type: text/plain; charset="UTF-8"
<a id="rest_code_c5306145557c404cb057447834ae501b-3" name="rest_code_c5306145557c404cb057447834ae501b-3"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-4" name="rest_code_c5306145557c404cb057447834ae501b-4"></a>Here's some ReStructuredText input that has a code block in it:
<a id="rest_code_c5306145557c404cb057447834ae501b-5" name="rest_code_c5306145557c404cb057447834ae501b-5"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-6" name="rest_code_c5306145557c404cb057447834ae501b-6"></a> &lt;#cb1-1&gt;Missing Ampersand in Code Block -ms output
<a id="rest_code_c5306145557c404cb057447834ae501b-7" name="rest_code_c5306145557c404cb057447834ae501b-7"></a>&lt;#cb1-2&gt;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &lt;#cb1-3&gt;
<a id="rest_code_c5306145557c404cb057447834ae501b-8" name="rest_code_c5306145557c404cb057447834ae501b-8"></a>&lt;#cb1-4&gt;Here's a code block containing ReStructuredText: &lt;#cb1-5&gt;
<a id="rest_code_c5306145557c404cb057447834ae501b-9" name="rest_code_c5306145557c404cb057447834ae501b-9"></a>&lt;#cb1-6&gt;.. code:: &lt;#cb1-7&gt; &lt;#cb1-8&gt;   .. container:: for-format ms
<a id="rest_code_c5306145557c404cb057447834ae501b-10" name="rest_code_c5306145557c404cb057447834ae501b-10"></a>&lt;#cb1-9&gt; &lt;#cb1-10&gt;      .. figure::
<a id="rest_code_c5306145557c404cb057447834ae501b-11" name="rest_code_c5306145557c404cb057447834ae501b-11"></a>davesmapper-2017-04-10-caves-4-numbered.eps &lt;#cb1-11&gt;         :alt:
<a id="rest_code_c5306145557c404cb057447834ae501b-12" name="rest_code_c5306145557c404cb057447834ae501b-12"></a>Map of Bandit's Cave &lt;#cb1-12&gt; &lt;#cb1-13&gt;      Map of Bandit's Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-13" name="rest_code_c5306145557c404cb057447834ae501b-13"></a>&lt;#cb1-14&gt; &lt;#cb1-15&gt;   .. container:: for-format html latex context
<a id="rest_code_c5306145557c404cb057447834ae501b-14" name="rest_code_c5306145557c404cb057447834ae501b-14"></a>epub &lt;#cb1-16&gt; &lt;#cb1-17&gt;      .. figure::
<a id="rest_code_c5306145557c404cb057447834ae501b-15" name="rest_code_c5306145557c404cb057447834ae501b-15"></a>davesmapper-2017-04-10-caves-4-numbered.png &lt;#cb1-18&gt;         :alt:
<a id="rest_code_c5306145557c404cb057447834ae501b-16" name="rest_code_c5306145557c404cb057447834ae501b-16"></a>Map of Bandit's Cave &lt;#cb1-19&gt; &lt;#cb1-20&gt;         Map of Bandit's Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-17" name="rest_code_c5306145557c404cb057447834ae501b-17"></a>&lt;#cb1-21&gt; &lt;#cb1-22&gt;How's that look? &lt;#cb1-23&gt;
<a id="rest_code_c5306145557c404cb057447834ae501b-18" name="rest_code_c5306145557c404cb057447834ae501b-18"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-19" name="rest_code_c5306145557c404cb057447834ae501b-19"></a>Here's the -ms output from it:
<a id="rest_code_c5306145557c404cb057447834ae501b-20" name="rest_code_c5306145557c404cb057447834ae501b-20"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-21" name="rest_code_c5306145557c404cb057447834ae501b-21"></a>.SH 1
<a id="rest_code_c5306145557c404cb057447834ae501b-22" name="rest_code_c5306145557c404cb057447834ae501b-22"></a>Missing Ampersand in Code Block -ms output
<a id="rest_code_c5306145557c404cb057447834ae501b-23" name="rest_code_c5306145557c404cb057447834ae501b-23"></a>.pdfhref O 1 "Missing Ampersand in Code Block -ms output"
<a id="rest_code_c5306145557c404cb057447834ae501b-24" name="rest_code_c5306145557c404cb057447834ae501b-24"></a>.pdfhref M "missing-ampersand-in-code-block--ms-output"
<a id="rest_code_c5306145557c404cb057447834ae501b-25" name="rest_code_c5306145557c404cb057447834ae501b-25"></a>.LP
<a id="rest_code_c5306145557c404cb057447834ae501b-26" name="rest_code_c5306145557c404cb057447834ae501b-26"></a>Here\[aq]s a code block containing ReStructuredText:
<a id="rest_code_c5306145557c404cb057447834ae501b-27" name="rest_code_c5306145557c404cb057447834ae501b-27"></a>.IP
<a id="rest_code_c5306145557c404cb057447834ae501b-28" name="rest_code_c5306145557c404cb057447834ae501b-28"></a>.nf
<a id="rest_code_c5306145557c404cb057447834ae501b-29" name="rest_code_c5306145557c404cb057447834ae501b-29"></a>\f[C]
<a id="rest_code_c5306145557c404cb057447834ae501b-30" name="rest_code_c5306145557c404cb057447834ae501b-30"></a>.. container:: for-format ms
<a id="rest_code_c5306145557c404cb057447834ae501b-31" name="rest_code_c5306145557c404cb057447834ae501b-31"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-32" name="rest_code_c5306145557c404cb057447834ae501b-32"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.eps
<a id="rest_code_c5306145557c404cb057447834ae501b-33" name="rest_code_c5306145557c404cb057447834ae501b-33"></a>      :alt: Map of Bandit\[aq]s Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-34" name="rest_code_c5306145557c404cb057447834ae501b-34"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-35" name="rest_code_c5306145557c404cb057447834ae501b-35"></a>   Map of Bandit\[aq]s Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-36" name="rest_code_c5306145557c404cb057447834ae501b-36"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-37" name="rest_code_c5306145557c404cb057447834ae501b-37"></a>\&amp;.. container:: for-format html latex context epub
<a id="rest_code_c5306145557c404cb057447834ae501b-38" name="rest_code_c5306145557c404cb057447834ae501b-38"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-39" name="rest_code_c5306145557c404cb057447834ae501b-39"></a>   .. figure:: davesmapper-2017-04-10-caves-4-numbered.png
<a id="rest_code_c5306145557c404cb057447834ae501b-40" name="rest_code_c5306145557c404cb057447834ae501b-40"></a>      :alt: Map of Bandit\[aq]s Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-41" name="rest_code_c5306145557c404cb057447834ae501b-41"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-42" name="rest_code_c5306145557c404cb057447834ae501b-42"></a>      Map of Bandit\[aq]s Cave
<a id="rest_code_c5306145557c404cb057447834ae501b-43" name="rest_code_c5306145557c404cb057447834ae501b-43"></a>\f[]
<a id="rest_code_c5306145557c404cb057447834ae501b-44" name="rest_code_c5306145557c404cb057447834ae501b-44"></a>.fi
<a id="rest_code_c5306145557c404cb057447834ae501b-45" name="rest_code_c5306145557c404cb057447834ae501b-45"></a>.LP
<a id="rest_code_c5306145557c404cb057447834ae501b-46" name="rest_code_c5306145557c404cb057447834ae501b-46"></a>How\[aq]s that look?
<a id="rest_code_c5306145557c404cb057447834ae501b-47" name="rest_code_c5306145557c404cb057447834ae501b-47"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-48" name="rest_code_c5306145557c404cb057447834ae501b-48"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-49" name="rest_code_c5306145557c404cb057447834ae501b-49"></a>See the first line that starts with .. container::? That line should start
<a id="rest_code_c5306145557c404cb057447834ae501b-50" name="rest_code_c5306145557c404cb057447834ae501b-50"></a>with \&amp; so it isn't interpreted as an *roff* command. As it is, when you
<a id="rest_code_c5306145557c404cb057447834ae501b-51" name="rest_code_c5306145557c404cb057447834ae501b-51"></a>build the PDF output from output that line disappears entirely with no
<a id="rest_code_c5306145557c404cb057447834ae501b-52" name="rest_code_c5306145557c404cb057447834ae501b-52"></a>warning to the user. (The default for *roff* processors like *groff* is to
<a id="rest_code_c5306145557c404cb057447834ae501b-53" name="rest_code_c5306145557c404cb057447834ae501b-53"></a>ignore unknown commands.)
<a id="rest_code_c5306145557c404cb057447834ae501b-54" name="rest_code_c5306145557c404cb057447834ae501b-54"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-55" name="rest_code_c5306145557c404cb057447834ae501b-55"></a>See the second line that starts with .. container::? That line *does* start
<a id="rest_code_c5306145557c404cb057447834ae501b-56" name="rest_code_c5306145557c404cb057447834ae501b-56"></a>with \&amp;. It makes it through fine. The other lines whose first
<a id="rest_code_c5306145557c404cb057447834ae501b-57" name="rest_code_c5306145557c404cb057447834ae501b-57"></a>non-whitespace character is . make it through fine because to make it a
<a id="rest_code_c5306145557c404cb057447834ae501b-58" name="rest_code_c5306145557c404cb057447834ae501b-58"></a>*roff* command the first character on the line has to be a period.
<a id="rest_code_c5306145557c404cb057447834ae501b-59" name="rest_code_c5306145557c404cb057447834ae501b-59"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-60" name="rest_code_c5306145557c404cb057447834ae501b-60"></a>--
<a id="rest_code_c5306145557c404cb057447834ae501b-61" name="rest_code_c5306145557c404cb057447834ae501b-61"></a>T. Kurt Bond, tkurtbond@gmail.com
<a id="rest_code_c5306145557c404cb057447834ae501b-62" name="rest_code_c5306145557c404cb057447834ae501b-62"></a>
<a id="rest_code_c5306145557c404cb057447834ae501b-63" name="rest_code_c5306145557c404cb057447834ae501b-63"></a>--000000000000360d1105a9a4da6e
</pre>
<p>See the weird psuedo-HTML tags like <code class="docutils literal"><span class="pre">&lt;#cb1-3&gt;</span></code> in the “plain” text
that seems to have resulted from <code class="docutils literal">&lt;span <span class="pre">id="cb1-3"&gt;&lt;a</span>
<span class="pre">href="#cb1-3"&gt;&lt;/a&gt;…&lt;/span&gt;</span></code>?  The person who replied to my message
used the <code class="docutils literal">text/plain</code>, and that included all those weird
<code class="docutils literal"><span class="pre">&lt;#cbX-Y&gt;</span></code> tags in the plain text reply, which, although they didn't
remark on the oddity, is how I came to know about the problem.</p>
<p>So, one thing to notice is that it was the first code block that was
messed up, and not the second.  It turns out that I specified a
(correct) language for syntax highlighting in the first code block,
<code class="docutils literal">restructuredtext</code>, and supplied an incorrect language for syntax
highlighting in the second block, <code class="docutils literal">nroff</code> <a class="footnote-reference brackets" href="#pygments-groff" id="id3">3</a>, which
should have been simply <code class="docutils literal">roff</code>.  And it turns out that if I don't
specify a language for the highlighting I don't get the <code class="docutils literal">&lt;span
<span class="pre">id="cb1-3"&gt;&lt;a</span> <span class="pre">href="#cb1-3"&gt;&lt;/a&gt;&lt;/span&gt;</span></code> type output, just a plain
&lt;code&gt; block in a plain &lt;pre&gt; block.</p>
<p>Weird.</p>
<p>(I suppose I could have made this entry shorter and easier to
understand by writing new shorter examples directly using
<code class="docutils literal">.. code::</code> directly, but I'm writing about an e-mail that I
actually sent, not a hypothetical e-mail.)</p>
<dl class="footnote brackets">
<dt class="label" id="plain-code-directive"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd>
<p>I've checked and this weirdness happens with plain <code class="docutils literal">.. code::</code>
directives as well.</p>
</dd>
<dt class="label" id="toolong"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd>
<p>I'm not quoting the whole file because the CSS portion of the
HTML makes it much too long to quote here.</p>
</dd>
<dt class="label" id="pygments-groff"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd>
<p>Annoyingly, <a class="reference external" href="https://pygments.org/languages/">pygments</a>, which I'm using to write this post for my
blog, calls that <code class="docutils literal">groff</code> instead of <code class="docutils literal">roff</code>, so if I want to turn
this into a e-mail via the route described here, I'll have to
change the source file for this.</p>
</dd>
</dl>
</div>
    </div>
    <script>var pfHeaderImgUrl = '';var pfHeaderTagline = '';var pfdisableClickToDel = 0;var pfHideImages = 0;var pfImageDisplayStyle = 'right';var pfDisablePDF = 0;var pfDisableEmail = 0;var pfDisablePrint = 0;var pfCustomCSS = '';var pfBtVersion='2';(function(){var js,pf;pf=document.createElement('script');pf.type='text/javascript';pf.src='//cdn.printfriendly.com/printfriendly.js';document.getElementsByTagName('head')[0].appendChild(pf)})();</script><a href="https://www.printfriendly.com" style="color:#6D9F00;text-decoration:none;" class="printfriendly" onclick="window.print();return false;" title="Printer Friendly and PDF"><img style="border:none;-webkit-box-shadow:none;box-shadow:none;" src="//cdn.printfriendly.com/buttons/printfriendly-pdf-button.png" alt="Print Friendly and PDF"></a>    
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../../categories/gmail/" rel="tag">gmail</a></li>
            <li><a class="tag p-category" href="../../../../../categories/html/" rel="tag">html</a></li>
            <li><a class="tag p-category" href="../../../../../categories/pandoc/" rel="tag">pandoc</a></li>
            <li><a class="tag p-category" href="../../../../../categories/rst/" rel="tag">rst</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../04/steve-jacksons-goal-with-gurps/" rel="prev" title="Steve Jackson's Goal with GURPS">Previous post</a>
            </li>
            <li class="next">
                <a href="../../07/savage-worlds-adventure-edition-fixes-spears/" rel="next" title="Savage Worlds Adventure Edition Fixes Spears">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="lacking-natural-simplicity",
            disqus_url="https://tkurtbond.github.io/posts/2020/07/05/line-number-anchors-in-pandocs-html-output-for-codeblocks-with-highlighting-mess-up-gmail-textplain-multipart-alternative/",
        disqus_title="Line number anchors in pandoc's HTML output for codeblocks with highlighting mess up Gmail text/plain multipart alternative",
        disqus_identifier="cache/posts/2020/07/05/line-number-anchors-in-pandocs-html-output-for-codeblocks-with-highlighting-mess-up-gmail-textplain-multipart-alternative.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="lacking-natural-simplicity";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
            <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
                    <div class="sidebar-module sidebar-module-inset">
      <h4>About</h4>
      <p>Lacking Natural Simplicity is one, not particularly flattering, 
         definition of sophisticated.  
         This blog chronicles my journey through our at times too complicated 
         and sophisticated world. </p>
    </div>
    <div class="sidebar-module">
      <h4>Links</h4>
      <ol class="list-unstyled">
<li><a href="../../../../../pages/about-the-blog/index.html">About the Blog</a></li>
        <li><a href="../../../../../pages/colophon/index.html">Colophon</a></li>
        <li><a href="../../../../../pages/static-pages-index/index.html">Pages</a></li>
        <li>
<a href="http://tkb.tx0.org/">My other web page</a>
            <p>    Mostly empty</p>
        </li>
      </ol>
</div>
    
            </div>
        <!--End of body content-->
        </div>
    </div>
</div>

<footer class="blog-footer" id="footer">
    Contents © 2021         <a href="mailto:tkurtbond@gmail.com">T. Kurt Bond</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
</footer><script src="../../../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
