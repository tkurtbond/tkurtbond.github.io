<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet href="https://tkurtbond.github.io/assets/xml/atom.xsl" type="text/xsl media="all"?>
<feed xml:lang="en" xmlns="http://www.w3.org/2005/Atom">
  <title>Lacking Natural Simplicity (Posts about software tools)</title>
  <id>https://tkurtbond.github.io/categories/software-tools.atom</id>
  <updated>2024-07-17T12:30:47Z</updated>
  <author>
    <name>T. Kurt Bond</name>
  </author>
  <link rel="self" type="application/atom+xml" href="https://tkurtbond.github.io/categories/software-tools.atom"/>
  <link rel="alternate" type="text/html" href="https://tkurtbond.github.io/categories/software-tools/"/>
  <generator uri="https://getnikola.com/">Nikola</generator>
  <entry>
    <title>Fixing a 41 year old bug in the SWTOOLS VOS SEDIT commmand</title>
    <id>https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/</id>
    <updated>2024-07-15T14:09:45-04:00</updated>
    <published>2024-07-15T14:09:45-04:00</published>
    <author>
      <name>T. Kurt Bond</name>
    </author>
    <link rel="alternate" type="text/html" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/"/>
    <summary type="html">&lt;p&gt;Today I fixed a 41 year old bug in the SWTOOLS VOS &lt;span class="command"&gt;sedit&lt;/span&gt; commmand!&lt;/p&gt;
&lt;p&gt;At work part of my job is to maintain an emulated VAX/VMS 5.5-2 system
for one of our clients.  I have been using the SWTOOLS Virtual
Operating System &lt;a class="reference external" href="https://tkurtbond.github.io/posts/2024/07/03/software-tools/"&gt;recently&lt;/a&gt; (Unix style
I/O redirection! And pipes!), and whenever I tried to use the sedit
command it would die with an integer overflow:&lt;/p&gt;
&lt;pre class="literal-block"&gt;%SYSTEM-F-INTOVF, arithmetic trap, integer overflow at PC=0002D6C9, PSL=03C00022

Improperly handled condition, image exit forced.

      Signal arguments              Stack contents

      Number = 00000003                00000000
      Name   = 0000047C                08000020
               0002D6C9                000017C4
               03C00022                7FEF9784
                                       0002D479
                                       00001DC0
                                       00000000
                                       08000020
                                       7FEF97B4
                                       7FEF979C

      Register dump

      R0 = 0000000E  R1 = 0002BAF4  R2 = 0000000F  R3 = 7FF6A489
      R4 = 7FFE5E0C  R5 = 7FFE5EBC  R6 = 00000000  R7 = 00000001
      R8 = 7FFECA4C  R9 = 7FFECC54  R10= 7FFED7D4  R11= 00001E94
      AP = 7FEF9738  FP = 7FEF96F8  SP = 7FEF976C  PC = 0002D6C9
      PSL= 03C00022&lt;/pre&gt;
&lt;p&gt;Drats, drats, drats.&lt;/p&gt;
&lt;p&gt;I use &lt;span class="command"&gt;sed&lt;/span&gt; frequently on Unix, and it would be nice to have
the SWTOOLS equivalent on VAX/VMS.  What could I do but set the
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Wayback_Machine_(Peabody%27s_Improbable_History)"&gt;Wayback Machine&lt;/a&gt;
for 1986 and dive in!&lt;/p&gt;
&lt;p&gt;Those following along may want to read my post about how the &lt;a class="reference external" href="slug://how-the-lbl-software-tools-system-organized-its-source-files"&gt;Software Tools VOS organized its source files&lt;/a&gt; first.&lt;/p&gt;
&lt;p&gt;The SWTOOLS VOS was written in &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Ratfor"&gt;Ratfor&lt;/a&gt;, which added structured
control structures and other niceties such as macros, include files,
and string constants to pre-1977 Fortran.  I suspect that even as late
as 1986, when the version of the SWTOOLS VOS was released, lots of
installations were on machines that only &lt;strong&gt;*had*&lt;/strong&gt; pre-1977 Fortran
compilers.&lt;/p&gt;
&lt;p&gt;Here's an example of &lt;span class="app"&gt;Ratfor&lt;/span&gt; source, from &lt;span class="file"&gt;sedit.r&lt;/span&gt;:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-1" name="rest_code_b401bc577706466c96a9d86bd14a3a24-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-1"&gt;&lt;/a&gt;&lt;span class="cp"&gt;# copyf - copy file name to opened file fdo&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-2" name="rest_code_b401bc577706466c96a9d86bd14a3a24-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-2"&gt;&lt;/a&gt;&lt;span class="k"&gt;subroutine &lt;/span&gt;&lt;span class="n"&gt;copyf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fdo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-3" name="rest_code_b401bc577706466c96a9d86bd14a3a24-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-3"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ARB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-4" name="rest_code_b401bc577706466c96a9d86bd14a3a24-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-4"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="n"&gt;fdo&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-5" name="rest_code_b401bc577706466c96a9d86bd14a3a24-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-5"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="n"&gt;fdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-6" name="rest_code_b401bc577706466c96a9d86bd14a3a24-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-6"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-7" name="rest_code_b401bc577706466c96a9d86bd14a3a24-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-7"&gt;&lt;/a&gt;&lt;span class="kt"&gt;character &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;namstr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MAXLINE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-8" name="rest_code_b401bc577706466c96a9d86bd14a3a24-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-8"&gt;&lt;/a&gt;&lt;span class="kt"&gt;character &lt;/span&gt;&lt;span class="n"&gt;getch&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-9" name="rest_code_b401bc577706466c96a9d86bd14a3a24-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-9"&gt;&lt;/a&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-10" name="rest_code_b401bc577706466c96a9d86bd14a3a24-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-10"&gt;&lt;/a&gt;&lt;span class="n"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="c"&gt;!=EOS; i=i+1)               #get name into string&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-11" name="rest_code_b401bc577706466c96a9d86bd14a3a24-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-11"&gt;&lt;/a&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;namstr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-12" name="rest_code_b401bc577706466c96a9d86bd14a3a24-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;namstr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EOS&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-13" name="rest_code_b401bc577706466c96a9d86bd14a3a24-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-13"&gt;&lt;/a&gt;&lt;span class="n"&gt;fdi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;namstr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;READ&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-14" name="rest_code_b401bc577706466c96a9d86bd14a3a24-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-14"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fdi&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ERR&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-15" name="rest_code_b401bc577706466c96a9d86bd14a3a24-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-15"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;call &lt;/span&gt;&lt;span class="n"&gt;cant&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;namstr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-16" name="rest_code_b401bc577706466c96a9d86bd14a3a24-16" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-16"&gt;&lt;/a&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fdi&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;!= EOF)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-17" name="rest_code_b401bc577706466c96a9d86bd14a3a24-17" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-17"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;call &lt;/span&gt;&lt;span class="n"&gt;putch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fdo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-18" name="rest_code_b401bc577706466c96a9d86bd14a3a24-18" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-18"&gt;&lt;/a&gt;&lt;span class="k"&gt;call close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fdi&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-19" name="rest_code_b401bc577706466c96a9d86bd14a3a24-19" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-19"&gt;&lt;/a&gt;&lt;span class="k"&gt;return&lt;/span&gt;
&lt;a id="rest_code_b401bc577706466c96a9d86bd14a3a24-20" name="rest_code_b401bc577706466c96a9d86bd14a3a24-20" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b401bc577706466c96a9d86bd14a3a24-20"&gt;&lt;/a&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can tell it was inspired by Unix.&lt;/p&gt;
&lt;p&gt;Here's the corresponding generated Fortran&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-1" name="rest_code_b4b6bb99660649c2908323da632aa784-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-1"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;SUBROUTINE &lt;/span&gt;&lt;span class="n"&gt;COPYF&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FDO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-2" name="rest_code_b4b6bb99660649c2908323da632aa784-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-2"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;INTEGER &lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2048&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-3" name="rest_code_b4b6bb99660649c2908323da632aa784-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-3"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;INTEGER &lt;/span&gt;&lt;span class="n"&gt;FDO&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-4" name="rest_code_b4b6bb99660649c2908323da632aa784-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-4"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;INTEGER &lt;/span&gt;&lt;span class="n"&gt;FDI&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-5" name="rest_code_b4b6bb99660649c2908323da632aa784-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-5"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;INTEGER &lt;/span&gt;&lt;span class="k"&gt;OPEN&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-6" name="rest_code_b4b6bb99660649c2908323da632aa784-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-6"&gt;&lt;/a&gt;&lt;span class="k"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;LOGICAL&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NAMSTR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2048&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-7" name="rest_code_b4b6bb99660649c2908323da632aa784-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-7"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kt"&gt;LOGICAL&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GETCH&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-8" name="rest_code_b4b6bb99660649c2908323da632aa784-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-8"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-9" name="rest_code_b4b6bb99660649c2908323da632aa784-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-9"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23190&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(.&lt;/span&gt;&lt;span class="nb"&gt;NOT&lt;/span&gt;&lt;span class="p"&gt;.(&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;NE&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="k"&gt;GOTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23192&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-10" name="rest_code_b4b6bb99660649c2908323da632aa784-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-10"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;NAMSTR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-11" name="rest_code_b4b6bb99660649c2908323da632aa784-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-11"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23191&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-12" name="rest_code_b4b6bb99660649c2908323da632aa784-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-12"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;GOTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23190&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-13" name="rest_code_b4b6bb99660649c2908323da632aa784-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-13"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23192&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CONTINUE&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-14" name="rest_code_b4b6bb99660649c2908323da632aa784-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-14"&gt;&lt;/a&gt;&lt;span class="k"&gt;      &lt;/span&gt;&lt;span class="n"&gt;NAMSTR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-15" name="rest_code_b4b6bb99660649c2908323da632aa784-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-15"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;FDI&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;OPEN&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NAMSTR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-16" name="rest_code_b4b6bb99660649c2908323da632aa784-16" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-16"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;IF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(.&lt;/span&gt;&lt;span class="nb"&gt;NOT&lt;/span&gt;&lt;span class="p"&gt;.(&lt;/span&gt;&lt;span class="n"&gt;FDI&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EQ&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="k"&gt;GOTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23193&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-17" name="rest_code_b4b6bb99660649c2908323da632aa784-17" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-17"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;CALL &lt;/span&gt;&lt;span class="n"&gt;CANT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NAMSTR&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-18" name="rest_code_b4b6bb99660649c2908323da632aa784-18" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-18"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23193&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CONTINUE&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-19" name="rest_code_b4b6bb99660649c2908323da632aa784-19" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-19"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23195&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(.&lt;/span&gt;&lt;span class="nb"&gt;NOT&lt;/span&gt;&lt;span class="p"&gt;.(&lt;/span&gt;&lt;span class="n"&gt;GETCH&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FDI&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NE&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="k"&gt;GOTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23196&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-20" name="rest_code_b4b6bb99660649c2908323da632aa784-20" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-20"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;CALL &lt;/span&gt;&lt;span class="n"&gt;PUTCH&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FDO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-21" name="rest_code_b4b6bb99660649c2908323da632aa784-21" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-21"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;GOTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;23195&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-22" name="rest_code_b4b6bb99660649c2908323da632aa784-22" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-22"&gt;&lt;/a&gt;&lt;span class="mi"&gt;23196&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CONTINUE&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-23" name="rest_code_b4b6bb99660649c2908323da632aa784-23" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-23"&gt;&lt;/a&gt;&lt;span class="k"&gt;      CALL CLOSE&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FDI&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-24" name="rest_code_b4b6bb99660649c2908323da632aa784-24" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-24"&gt;&lt;/a&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="k"&gt;RETURN&lt;/span&gt;
&lt;a id="rest_code_b4b6bb99660649c2908323da632aa784-25" name="rest_code_b4b6bb99660649c2908323da632aa784-25" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_b4b6bb99660649c2908323da632aa784-25"&gt;&lt;/a&gt;&lt;span class="k"&gt;      END&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice that the &lt;code class="docutils literal"&gt;character&lt;/code&gt; variables got changed to &lt;code class="docutils literal"&gt;LOGICAL*1&lt;/code&gt;?
That turns out to be 1 byte variable...&lt;/p&gt;
&lt;p&gt;So, to start, I needed to run sedit in the debugger.  That's easy
enough:&lt;/p&gt;
&lt;pre class="literal-block"&gt;% cd ~tmp
% mkdir sedit
% cd sedit
/dua1/software/swtools/tmp/sedit/
% get -r1.5 ~src/sedit.tcs &amp;gt;sedit.w
% ar xv sedit.w
patdef
csedit
sedit.r
sedit.fmt
% rc -d -v sedit.r
~bin/ratp1.exe sedit.r | ~bin/ratp2.exe &amp;gt;sedit.f
~bin/fc.exe -v -d sedit.f
for/noop/object=sedit.obj/nolist/check=all/debug=all sedit.f
~bin/ld.exe -v -d sedit.obj
$ link/exe=dua1:[software.swtools.tmp.sedit]sedit.exe/debug/nomap sys$input/opti
ons
dua1:[software.swtools.tmp.sedit]sedit.obj,-
dua1:[software.swtools.bin]rlib.olb/incl=(tools$main),-
dua1:[software.swtools.bin]rlib.olb/libr
% echo Hello | sedit "s/H/J/"
%DEBUG-I-CANTCREATEMAIN, could not create the debugger subprocess
%DEBUG-I-CANTCREATEMAIN, could not create the debugger subprocess
-LIB-F-NOCLI, no CLI present to perform function
-LIB-F-NOCLI, no CLI present to perform function
%DEBUG-I-SHRPRC, debugger will share user process
%DEBUG-I-SHRPRC, debugger will share user process

         VAX DEBUG Version V5.5-023

%DEBUG-I-INITIAL, language is MACRO, module set to TOOLS$MAIN

DBG&amp;gt; go
%DEBUG-I-DYNMODSET, setting module DOCOM
%SYSTEM-F-INTOVF, arithmetic trap, integer overflow at PC=0002E345, PSL=03C00022
break on unhandled exception preceding DOCOM\%LINE 20
    20:       IF (.NOT.(CMD .EQ. 97))GOTO 23162
DBG&amp;gt; go
%DEBUG-I-DYNMODSET, setting module DOCOM
%SYSTEM-F-INTOVF, arithmetic trap, integer overflow at PC=0002E345, PSL=03C00022
break on unhandled exception preceding DOCOM\%LINE 20
    20:       IF (.NOT.(CMD .EQ. 97))GOTO 23162
DBG&amp;gt;&lt;/pre&gt;
&lt;p&gt;I guess we'll need a little more context.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-1" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-1"&gt;&lt;/a&gt;DBG&amp;gt; type docom\1:20
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-2" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-2"&gt;&lt;/a&gt;module DOCOM
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-3" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-3"&gt;&lt;/a&gt;     1:       SUBROUTINE DOCOM(I, LINBUF, LINENO)
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-4" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-4"&gt;&lt;/a&gt;     2:       LOGICAL*1 LINBUF(2048)
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-5" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-5"&gt;&lt;/a&gt;     3:       INTEGER I, LINENO
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-6" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-6"&gt;&lt;/a&gt;     4:       LOGICAL*1 CMD
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-7" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-7"&gt;&lt;/a&gt;     5:       INTEGER K1, K2
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-8" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-8"&gt;&lt;/a&gt;     6:       INTEGER AQ
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-9" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-9"&gt;&lt;/a&gt;     7:       INTEGER IQ
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-10" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-10"&gt;&lt;/a&gt;     8:       INTEGER BUF
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-11" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-11"&gt;&lt;/a&gt;     9:       INTEGER LASTBF
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-12" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-12"&gt;&lt;/a&gt;    10:       INTEGER NLINES
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-13" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-13"&gt;&lt;/a&gt;    11:       INTEGER LINE1
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-14" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-14"&gt;&lt;/a&gt;    12:       INTEGER LINE2
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-15" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-15"&gt;&lt;/a&gt;    13:       INTEGER PAT
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-16" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-16" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-16"&gt;&lt;/a&gt;    14:       INTEGER PREVC
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-17" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-17" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-17"&gt;&lt;/a&gt;    15:       INTEGER NFLAG
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-18" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-18" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-18"&gt;&lt;/a&gt;    16:       INTEGER QFLAG
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-19" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-19" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-19"&gt;&lt;/a&gt;    17:       COMMON /CSEDIT/ AQ, IQ, BUF(20000), LASTBF, NLINES, LINE1, LINE2,
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-20" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-20" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-20"&gt;&lt;/a&gt;    18:      *PAT(132), PREVC, NFLAG, QFLAG
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-21" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-21" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-21"&gt;&lt;/a&gt;    19:       CMD = BUF(I+5)
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-22" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-22" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-22"&gt;&lt;/a&gt;    20:       IF (.NOT.(CMD .EQ. 97))GOTO 23162
&lt;a id="rest_code_f1b3b236708b48b2aead8719840c2ec0-23" name="rest_code_f1b3b236708b48b2aead8719840c2ec0-23" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_f1b3b236708b48b2aead8719840c2ec0-23"&gt;&lt;/a&gt;DBG&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ok, line 19 is where the the integer overflow happened.  &lt;code class="docutils literal"&gt;BUF&lt;/code&gt; is an
array of &lt;code class="docutils literal"&gt;INTEGER&lt;/code&gt;s, while &lt;code class="docutils literal"&gt;CMD&lt;/code&gt; is a &lt;code class="docutils literal"&gt;LOGICAL*1&lt;/code&gt;, which, if I
look at the &lt;span class="file"&gt;sedit.r&lt;/span&gt; source:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-1" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-1"&gt;&lt;/a&gt;&lt;span class="cp"&gt;# docom - execute a single command at buf(i) on linbuf and lineno&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-2" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-2"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;subroutine &lt;/span&gt;&lt;span class="n"&gt;docom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;linbuf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lineno&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-3" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-3"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="kt"&gt;character &lt;/span&gt;&lt;span class="n"&gt;linbuf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MAXLINE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-4" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-4"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lineno&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-5" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-5"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="kt"&gt;character &lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-6" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-6"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="n"&gt;k1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;k2&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-7" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-7"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;include &lt;/span&gt;&lt;span class="n"&gt;csedit&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-8" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-8"&gt;&lt;/a&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-9" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-9"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;COMMAND&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-10" name="rest_code_9884aae6ccf04c4190fe40e3f0c971d7-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_9884aae6ccf04c4190fe40e3f0c971d7-10"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="err"&gt;…&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;started as a &lt;code class="docutils literal"&gt;character&lt;/code&gt; and got translated to a &lt;code class="docutils literal"&gt;LOGICAL*1&lt;/code&gt;, the
one byte logical data type.  Normally that's ok, because we're just working
with ASCII, so any character should fit in in one byte.  Lets take a look:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-1" name="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8ccbab59d0b54e999f7cc1d440b4481c-1"&gt;&lt;/a&gt;DBG&amp;gt; ex buf[i+5]
&lt;a id="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-2" name="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8ccbab59d0b54e999f7cc1d440b4481c-2"&gt;&lt;/a&gt;DOCOM\BUF[19]:  00000173
&lt;a id="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-3" name="rest_code_8ccbab59d0b54e999f7cc1d440b4481c-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8ccbab59d0b54e999f7cc1d440b4481c-3"&gt;&lt;/a&gt;DBG&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Oh dear.  That's hexadecimal 173, which is decimal 371.  No wonder we
got an arithmetic trap, integer overflow.&lt;/p&gt;
&lt;p&gt;If I look for occurrences of &lt;code class="docutils literal"&gt;buf&lt;/code&gt; in &lt;span class="file"&gt;sedit.r&lt;/span&gt; (using emacs
18.55.105) I see lots of lines like where &lt;code class="docutils literal"&gt;buf&lt;/code&gt; is passed to
subroutine &lt;code class="docutils literal"&gt;addint&lt;/code&gt;, which is not documented in the manual pages,
unfortunately, but is in the runtime library &lt;span class="file"&gt;RLIB.OLB&lt;/span&gt;.  On
VAX/VMS the source for that is in &lt;span class="file"&gt;~vms/rlib.w&lt;/span&gt;:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-1" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-1"&gt;&lt;/a&gt;&lt;span class="cp"&gt;# AddInt      Put int into intara if it fits, increment j&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-2" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-2"&gt;&lt;/a&gt;&lt;span class="cp"&gt;# works with an array of integers&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-3" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-4" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-4"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer &lt;/span&gt;&lt;span class="k"&gt;function &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;intara&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-5" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-5"&gt;&lt;/a&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-6" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-6"&gt;&lt;/a&gt;&lt;span class="kt"&gt;integer         &lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;intara&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-7" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-7"&gt;&lt;/a&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-8" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-8"&gt;&lt;/a&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-9" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-9"&gt;&lt;/a&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-10" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-10"&gt;&lt;/a&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-11" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-11"&gt;&lt;/a&gt;&lt;span class="n"&gt;intara&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-12" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-12"&gt;&lt;/a&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-13" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-13"&gt;&lt;/a&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-14" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-14"&gt;&lt;/a&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;YES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-15" name="rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7fdcca2fa5524c2d96d23b3b8d99dd93-15"&gt;&lt;/a&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Yes, that's just putting an integer in an array and incrementing the
variable that stores where the next one goes.&lt;/p&gt;
&lt;p&gt;Ok, lets look at all the
&lt;code class="docutils literal"&gt;addint&lt;/code&gt; calls.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-1" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-1"&gt;&lt;/a&gt;&lt;span class="n"&gt;Lines&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;matching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"\\baddint\\b("&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sedit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-2" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-2"&gt;&lt;/a&gt;&lt;span class="mi"&gt;176&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-3" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-3"&gt;&lt;/a&gt;&lt;span class="mi"&gt;223&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nlines&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-4" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-4"&gt;&lt;/a&gt;&lt;span class="mi"&gt;224&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-5" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-5"&gt;&lt;/a&gt;&lt;span class="mi"&gt;225&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-6" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-6"&gt;&lt;/a&gt;&lt;span class="mi"&gt;226&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-7" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-7"&gt;&lt;/a&gt;&lt;span class="mi"&gt;229&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NOTSTATE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-8" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-8"&gt;&lt;/a&gt;&lt;span class="mi"&gt;235&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OKSTATE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-9" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-9"&gt;&lt;/a&gt;&lt;span class="mi"&gt;236&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-10" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-10"&gt;&lt;/a&gt;&lt;span class="mi"&gt;238&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-11" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-11"&gt;&lt;/a&gt;&lt;span class="mi"&gt;242&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-12" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-12"&gt;&lt;/a&gt;&lt;span class="mi"&gt;248&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-13" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-13"&gt;&lt;/a&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-14" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-14"&gt;&lt;/a&gt;&lt;span class="mi"&gt;260&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EOS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-15" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-15"&gt;&lt;/a&gt;&lt;span class="mi"&gt;269&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gflag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-16" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-16" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-16"&gt;&lt;/a&gt;&lt;span class="mi"&gt;270&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pflag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-17" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-17" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-17"&gt;&lt;/a&gt;&lt;span class="mi"&gt;271&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-18" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-18" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-18"&gt;&lt;/a&gt;&lt;span class="mi"&gt;273&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-19" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-19" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-19"&gt;&lt;/a&gt;&lt;span class="mi"&gt;276&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EOS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-20" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-20" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-20"&gt;&lt;/a&gt;&lt;span class="mi"&gt;286&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fdw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-21" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-21" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-21"&gt;&lt;/a&gt;&lt;span class="mi"&gt;452&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;dotext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EOS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastbf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAXBUF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-22" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-22" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-22"&gt;&lt;/a&gt;&lt;span class="mi"&gt;695&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_7ea452909b7d49e096fe22958b0b1cec-23" name="rest_code_7ea452909b7d49e096fe22958b0b1cec-23" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_7ea452909b7d49e096fe22958b0b1cec-23"&gt;&lt;/a&gt;&lt;span class="mi"&gt;713&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;addint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxsiz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Some of the things they're adding to &lt;code class="docutils literal"&gt;buf&lt;/code&gt; are clearly integers
(&lt;code class="docutils literal"&gt;nlines&lt;/code&gt;, and probably &lt;code class="docutils literal"&gt;NOTSTATE&lt;/code&gt; and &lt;code class="docutils literal"&gt;OKSTATE&lt;/code&gt;), but those
&lt;code class="docutils literal"&gt;EOS&lt;/code&gt; are the SWTOOLS VOS equivalent of the C &lt;code class="docutils literal"&gt;'\0'&lt;/code&gt; that ends a
string, so those particular ones definitely hold characters.&lt;/p&gt;
&lt;p&gt;Well, if I want to debug that I'm going to have to rebuild the SWTOOLS
VOS with debugging turned on.  Investigating it turns out that I need
to add &lt;code class="docutils literal"&gt;/DEBUG&lt;/code&gt; to the &lt;span class="command"&gt;macro&lt;/span&gt; and &lt;span class="command"&gt;fortran&lt;/span&gt;
commands in &lt;span class="file"&gt;asmlib.com&lt;/span&gt;, &lt;span class="file"&gt;asmprm.com&lt;/span&gt;, &lt;span class="file"&gt;build.com&lt;/span&gt;,
and &lt;span class="file"&gt;compile.com&lt;/span&gt; in &lt;span class="file"&gt;~bin&lt;/span&gt;, and then execute
&lt;span class="file"&gt;~bin:toolgen.com&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Once that is done I start stepping through various routines.
Eventually I figure out that it &lt;code class="docutils literal"&gt;buf(19)&lt;/code&gt; is the element that ends
up with the 173 hex, and set a watch on it.  And indeed it is getting
passed a 173.  Sigh.&lt;/p&gt;
&lt;p&gt;Doing a &lt;code class="docutils literal"&gt;SHOW STACK&lt;/code&gt; in the &lt;span class="app"&gt;VMS Debugger&lt;/span&gt; shows that the
&lt;code class="docutils literal"&gt;addint()&lt;/code&gt; call that dies is in the subroutine &lt;code class="docutils literal"&gt;compil()&lt;/code&gt;.  Lets
take a look:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-1" name="rest_code_49478249ca594892b2d2ef5487665c04-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-1"&gt;&lt;/a&gt;DBG&amp;gt; type compil\50:65
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-2" name="rest_code_49478249ca594892b2d2ef5487665c04-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-2"&gt;&lt;/a&gt;module COMPIL
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-3" name="rest_code_49478249ca594892b2d2ef5487665c04-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-3"&gt;&lt;/a&gt;    50:       STATUS = ADDINT(LINE2, BUF, LASTBF, 20000)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-4" name="rest_code_49478249ca594892b2d2ef5487665c04-4" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-4"&gt;&lt;/a&gt;    51:       COM = CLOWER(LIN(I))
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-5" name="rest_code_49478249ca594892b2d2ef5487665c04-5" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-5"&gt;&lt;/a&gt;    52:       IF (.NOT.(COM .EQ. 33))GOTO 23068
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-6" name="rest_code_49478249ca594892b2d2ef5487665c04-6" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-6"&gt;&lt;/a&gt;    53:       STATUS = ADDINT(1, BUF, LASTBF, 20000)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-7" name="rest_code_49478249ca594892b2d2ef5487665c04-7" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-7"&gt;&lt;/a&gt;    54:       I = I+1
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-8" name="rest_code_49478249ca594892b2d2ef5487665c04-8" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-8"&gt;&lt;/a&gt;    55:       CALL SKIPBL(LIN, I)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-9" name="rest_code_49478249ca594892b2d2ef5487665c04-9" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-9"&gt;&lt;/a&gt;    56:       COM = CLOWER(LIN(I))
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-10" name="rest_code_49478249ca594892b2d2ef5487665c04-10" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-10"&gt;&lt;/a&gt;    57:       GOTO 23069
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-11" name="rest_code_49478249ca594892b2d2ef5487665c04-11" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-11"&gt;&lt;/a&gt;    58: 23068 CONTINUE
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-12" name="rest_code_49478249ca594892b2d2ef5487665c04-12" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-12"&gt;&lt;/a&gt;    59:       STATUS = ADDINT(0, BUF, LASTBF, 20000)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-13" name="rest_code_49478249ca594892b2d2ef5487665c04-13" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-13"&gt;&lt;/a&gt;    60: 23069 CONTINUE
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-14" name="rest_code_49478249ca594892b2d2ef5487665c04-14" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-14"&gt;&lt;/a&gt;    61:       STATUS = ADDINT(COM, BUF, LASTBF, 20000)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-15" name="rest_code_49478249ca594892b2d2ef5487665c04-15" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-15"&gt;&lt;/a&gt;    62:       IF (.NOT.(COM .EQ. 97 .AND. FD .NE. 0))GOTO 23070
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-16" name="rest_code_49478249ca594892b2d2ef5487665c04-16" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-16"&gt;&lt;/a&gt;    63:       STATUS = ADDINT(0, BUF, LASTBF, 20000)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-17" name="rest_code_49478249ca594892b2d2ef5487665c04-17" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-17"&gt;&lt;/a&gt;    64:       STATUS = DOTEXT(FD)
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-18" name="rest_code_49478249ca594892b2d2ef5487665c04-18" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-18"&gt;&lt;/a&gt;    65:       GOTO 23071
&lt;a id="rest_code_49478249ca594892b2d2ef5487665c04-19" name="rest_code_49478249ca594892b2d2ef5487665c04-19" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_49478249ca594892b2d2ef5487665c04-19"&gt;&lt;/a&gt;DBG&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Line 61 is the one that dies.  Here &lt;code class="docutils literal"&gt;addint()&lt;/code&gt; is being passed the
variable &lt;code class="docutils literal"&gt;COM&lt;/code&gt;.  Lets take a look at the &lt;span class="app"&gt;Ratfor&lt;/span&gt; source for
its definition:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code fortran"&gt;&lt;a id="rest_code_8270926a77c94de08721a016647db2ec-1" name="rest_code_8270926a77c94de08721a016647db2ec-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8270926a77c94de08721a016647db2ec-1"&gt;&lt;/a&gt;&lt;span class="cp"&gt;# compil - "compile" command in lin(i) from file fd, increment i&lt;/span&gt;
&lt;a id="rest_code_8270926a77c94de08721a016647db2ec-2" name="rest_code_8270926a77c94de08721a016647db2ec-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8270926a77c94de08721a016647db2ec-2"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="k"&gt;subroutine &lt;/span&gt;&lt;span class="n"&gt;compil&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_8270926a77c94de08721a016647db2ec-3" name="rest_code_8270926a77c94de08721a016647db2ec-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_8270926a77c94de08721a016647db2ec-3"&gt;&lt;/a&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="kt"&gt;character &lt;/span&gt;&lt;span class="n"&gt;lin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MAXLINE&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Oh, look, &lt;code class="docutils literal"&gt;com&lt;/code&gt; is a character, that gets translated by
&lt;span class="app"&gt;Ratfor&lt;/span&gt; to a &lt;code class="docutils literal"&gt;LOGICAL*1&lt;/code&gt;, and it is a byte, while the integers
that get passed in are longwords, which are 32 bytes long…  Uh,
doesn't Fortran pass everything by reference?  So &lt;code class="docutils literal"&gt;addint()&lt;/code&gt; gets
passed the address of a byte, but interprets it as the address of a
longword, so it picks up 3 extra bytes.  For whatever reason, there is
a 1 in the byte right next to the byte for &lt;code class="docutils literal"&gt;com&lt;/code&gt;, so we get (hex,
remember) 173 instead of 73, which is the ASCII for &lt;code class="docutils literal"&gt;s&lt;/code&gt;, which the s
in our &lt;code class="docutils literal"&gt;sedit "s/H/J/"&lt;/code&gt;!&lt;/p&gt;
&lt;p&gt;Ok, that should be easy to fix: introduce an integer temporary
variable, assign &lt;code class="docutils literal"&gt;com&lt;/code&gt; to it, and pass it instead.&lt;/p&gt;
&lt;p&gt;Here's the VMS diff:&lt;/p&gt;
&lt;pre class="literal-block"&gt;************
File DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;6
  206      integer comint
  207      integer fd
******
File DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;1
  206      integer fd
************
************
File DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;6
  237      comint = com
  238      status = addint(comint, buf, lastbf, MAXBUF)
  239      if (com == APPENDCOM &amp;amp; fd != NO) {
******
File DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;1
  236      status = addint(com, buf, lastbf, MAXBUF)
  237      if (com == APPENDCOM &amp;amp; fd != NO) {
************

Number of difference sections found: 2
Number of difference records found: 3

DIFFERENCES /IGNORE=()/MERGED=1/OUTPUT=DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.DIFF;1-
    DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;6-
    DUA1:[SOFTWARE.SWTOOLS.TMP]SEDIT.R;1&lt;/pre&gt;
&lt;p&gt;Recompile, lets see:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-1" name="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-1" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_2c25d94d9e8b4b908a1b6a68c742894e-1"&gt;&lt;/a&gt;% echo Hello | sedit "s/H/J/"
&lt;a id="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-2" name="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-2" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_2c25d94d9e8b4b908a1b6a68c742894e-2"&gt;&lt;/a&gt;Jello
&lt;a id="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-3" name="rest_code_2c25d94d9e8b4b908a1b6a68c742894e-3" href="https://tkurtbond.github.io/posts/2024/07/15/fixing-a-41-year-old-bug-in-the-swtools-vos-sedit-commmand/#rest_code_2c25d94d9e8b4b908a1b6a68c742894e-3"&gt;&lt;/a&gt;%
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That did it!&lt;/p&gt;</summary>
    <category term="fortran" label="fortran"/>
    <category term="lbl-tools" label="lbl tools"/>
    <category term="ratfor" label="ratfor"/>
    <category term="software-tools" label="software tools"/>
    <category term="software-tools-virtual-operating-system" label="software tools virtual operating system"/>
    <category term="swtools" label="swtools"/>
  </entry>
  <entry>
    <title>Software Tools</title>
    <id>https://tkurtbond.github.io/posts/2024/07/03/software-tools/</id>
    <updated>2024-07-03T09:59:31-04:00</updated>
    <published>2024-07-03T09:59:31-04:00</published>
    <author>
      <name>T. Kurt Bond</name>
    </author>
    <link rel="alternate" type="text/html" href="https://tkurtbond.github.io/posts/2024/07/03/software-tools/"/>
    <summary type="html">&lt;p&gt;When I was in college in the 1980s the school I was at used Digital
Equipment Corporation VAXes running VMS, and didn't have any Unix
machines.  I was quite interested in Unix and the Unix philosophy, but
was frustrated by my lack of access to Unix machines.  However,
Brian W. Kernighan and P. J. Plauger wrote a couple of books about
writing tools in the Unix style: &lt;cite&gt;Software Tools&lt;/cite&gt; was in
published in 1976 and used Fortran as its portable implementation
language, while &lt;cite&gt;Software Tools in Pascal&lt;/cite&gt; was published in
1981 and used Pascal.&lt;/p&gt;
&lt;img alt="/images/swtools.jpeg" src="https://tkurtbond.github.io/images/swtools.jpeg"&gt;
&lt;p&gt;Here is a quote repeated on each book's cover:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Good Programming is not learned from generalities, but by seeing
how significant programs can be made clean, easy to read, easy to
maintain and modify, human-engineered, efficient, and reliable, by
the application of common sense and good programming practices.
Careful study and imitation of good programs leads to better
writing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Both books worked through writing software tools that were simpler but
still useful versions of many of the standard Unix tools.&lt;/p&gt;
&lt;p&gt;I got &lt;cite&gt;Software Tools in Pascal&lt;/cite&gt; because I knew Pascal better
than Fortran and worked through implementing each of the programs on
the college's VAX, which taught me a lot about programming and was
significant influence on me.  I later got &lt;cite&gt;Software Tools&lt;/cite&gt;
because I wanted to read the section on implementing the ratfor
processor which that book used to add additional control structures
unavailable in the Fortran of the day.&lt;/p&gt;
&lt;p&gt;I was not the only person who was influenced by these books.
Deborah K. Scherrer, Dennis E. Hall, and Joseph S. Sventek at Lawrence
Berkeley National Laboratory with help from others greatly expanded
the set of programs from the book into an entire Virtual Operating
System (VOS), and founded the &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Software_Tools_Users_Group"&gt;Software Tools Users Group&lt;/a&gt; in 1976
to distribute it, eventually leading to ports on over 50 operating
systems.&lt;/p&gt;
&lt;p&gt;Luckily for me VAX/VMS was one of those operating systems, and the
port appeared on various tapes distributed by DECUS, the Digital
Equipment Computer Users' Society.  Luckily MPL Corporation, where I
worked at the time, always got the DECUS tapes and had a Fortran
compiler, so I could install it there.  I found it a very useful and
usable computing environment.&lt;/p&gt;
&lt;p&gt;Anyway, I retain a fondness for that software, known variously as
LBLTOOLS, LBL SWTOOLS, and SWTOOLS VOS, and have begun using the version
from the &lt;a class="reference external" href="https://www.digiater.nl/openvms/decus/zips_vms_attributes/lt86a.zip"&gt;DECUS VAX Languages &amp;amp; Tools SIG tape from 1986&lt;/a&gt;
again on the (emulated) VAX I maintain at work.  This gave me the
opportunity create a &lt;a class="reference external" href="https://tkurtbond.github.io/swtoolsman.pdf"&gt;PDF with the documentation&lt;/a&gt;
for that version, which I'm making available here for the curious.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“I really enjoyed that book.  The first computer book I read where
I thought my world was larger after reading it.” — C. Paul Bond&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;Last edited: 2024-07-15 14:25:36 EDT&lt;/em&gt;&lt;/p&gt;
&lt;!-- Local Variables:
time-stamp-format: "%Y-%02m-%02d %02H:%02M:%02S %Z"
time-stamp-start: "\\*Last edited:[ \t]+\\\\?"
time-stamp-end: "\\*\\\\?\n"
time-stamp-line-limit: -20
End: --&gt;</summary>
    <category term="brian-w-kernighan" label="brian w. kernighan"/>
    <category term="decus" label="decus"/>
    <category term="fortran" label="fortran"/>
    <category term="lbltools" label="lbltools"/>
    <category term="lt86-tape" label="lt86 tape"/>
    <category term="pj-plauger" label="p.j. plauger"/>
    <category term="pascal" label="pascal"/>
    <category term="ratfor" label="ratfor"/>
    <category term="software-tools" label="software tools"/>
    <category term="swtools" label="swtools"/>
    <category term="vax" label="vax"/>
    <category term="vms" label="vms"/>
    <category term="vos" label="vos"/>
  </entry>
</feed>
