<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Lacking Natural Simplicity (Posts about groff ms macros)</title><link>https://tkurtbond.github.io/</link><description></description><atom:link href="https://tkurtbond.github.io/categories/groff-ms-macros.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2024 &lt;a href="mailto:tkurtbond@gmail.com"&gt;T. Kurt Bond&lt;/a&gt; </copyright><lastBuildDate>Tue, 23 Jan 2024 18:49:40 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Customizing pandoc ms output with a Lua filter</title><link>https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/</link><dc:creator>T. Kurt Bond</dc:creator><description>&lt;p&gt;This article started as a &lt;a class="reference external" href="https://groups.google.com/d/msg/pandoc-discuss/UJgyLbxTNxo/MZDVFts-BAAJ"&gt;message&lt;/a&gt; I sent to the the &lt;a class="reference external" href="https://groups.google.com/forum/#!forum/pandoc-discuss"&gt;pandoc-discuss&lt;/a&gt;
Google Group.  This version has more links and has been slightly
reworded.&lt;/p&gt;
&lt;p&gt;I work with &lt;a class="reference external" href="https://docutils.sourceforge.io/rst.html"&gt;ReStructuredText&lt;/a&gt; documents a lot and often use &lt;a class="reference external" href="https://pandoc.org/"&gt;pandoc&lt;/a&gt; to
format them, especially to PDF by way of &lt;span class="app"&gt;pandoc&lt;/span&gt;'s &lt;code class="docutils literal"&gt;ms&lt;/code&gt;
output format, which uses &lt;span class="app"&gt;groff&lt;/span&gt; with the &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;-ms&lt;/span&gt;&lt;/code&gt; macros to produce the
PDF output.  Using &lt;code class="docutils literal"&gt;ms&lt;/code&gt; output is fast, &lt;span class="app"&gt;groff&lt;/span&gt; is usually available
on the operating systems I use, and if you &lt;em&gt;do&lt;/em&gt; have to install &lt;span class="app"&gt;groff&lt;/span&gt;
it is easy to do and much, much smaller than any &lt;span class="app"&gt;TeX&lt;/span&gt; distributions.&lt;/p&gt;
&lt;p&gt;However, it would be a nice to be able to customize the &lt;code class="docutils literal"&gt;ms&lt;/code&gt; output
more for specific input, like if you are using technical writing and
are pining for something like the various inline roles of &lt;a class="reference external" href="https://tdg.docbook.org/tdg/5.1/ch02.html#s.inline"&gt;DocBook&lt;/a&gt;, or
wanted poems to be typeset more stylishly that the &lt;code class="docutils literal"&gt;ms&lt;/code&gt; output does.&lt;/p&gt;
&lt;p&gt;You should probably be a little familiar with the &lt;a class="reference external" href="https://pandoc.org/MANUAL.html"&gt;Pandoc User
Manual&lt;/a&gt; and have the documentation for &lt;a class="reference external" href="https://pandoc.org/lua-filters.html"&gt;Lua Filter&lt;/a&gt;'s available for
reference while reading this article.  And having a reading
familiarity with &lt;a class="reference external" href="https://www.gnu.org/software/groff/"&gt;groff&lt;/a&gt; and its &lt;a class="reference external" href="https://www.gnu.org/software/groff/manual/"&gt;manual&lt;/a&gt; and specifically the &lt;a class="reference external" href="https://www.gnu.org/software/groff/manual/html_node/ms.html#ms"&gt;-ms
macros&lt;/a&gt; will be useful too.  And maybe &lt;a class="reference external" href="https://www.lua.org/"&gt;Lua&lt;/a&gt; as well.&lt;/p&gt;
&lt;p&gt;Starting with an &lt;a class="reference external" href="https://dave.autonoma.ca/blog/2020/04/28/typesetting-markdown-part-8/"&gt;article&lt;/a&gt; from Dave Jarvis that had an example &lt;a class="reference external" href="https://pandoc.org/lua-filters.html"&gt;Lua
filter&lt;/a&gt; for customizing the &lt;span class="app"&gt;ConTeXt&lt;/span&gt; output and a little help
from the pandoc-discuss mailing list I came up with this example &lt;a class="reference external" href="https://pandoc.org/lua-filters.html"&gt;Lua
Filter&lt;/a&gt; that formats program names and poems specially.&lt;/p&gt;
&lt;p&gt;This filter wraps spans with a class, such as from interpreted text
roles defined in the source ReST (like &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;:program:`pandoc`&lt;/span&gt;&lt;/code&gt;) in calls
to user defined &lt;span class="app"&gt;groff&lt;/span&gt; strings &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;\*[start&amp;lt;class&amp;gt;]&lt;/span&gt;&lt;/code&gt; and
&lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;\*[stop&amp;lt;class&amp;gt;]&lt;/span&gt;&lt;/code&gt;.  (I've specified the string definitions for
&lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;\*[startprogram]&lt;/span&gt;&lt;/code&gt; and &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;\*[stopprogram]&lt;/span&gt;&lt;/code&gt; in the source ReST as a
raw block for &lt;code class="docutils literal"&gt;ms&lt;/code&gt; output but they could be in a customized &lt;code class="docutils literal"&gt;ms&lt;/code&gt;
pandoc template, too.)  These strings can include &lt;span class="app"&gt;groff&lt;/span&gt; escapes to
change the font and the glyph color and then change back to the
previous font and glyph color.  In this example I made PDF output for
the interpreted text role &lt;code class="docutils literal"&gt;program&lt;/code&gt; come out in a constant width
font and in red.&lt;/p&gt;
&lt;p&gt;It also wraps divs with classes with calls to user defined &lt;span class="app"&gt;groff&lt;/span&gt;
macros &lt;code class="docutils literal"&gt;.start&amp;lt;class&amp;gt;&lt;/code&gt; and &lt;code class="docutils literal"&gt;.stop&amp;lt;class&amp;gt;&lt;/code&gt; (also included in the
source ReST in the raw block for ms output).&lt;/p&gt;
&lt;p&gt;For divs with the poem class, it converts any contained LineBlock
elements into a list of Plain elements containing its contents,
avoiding the ms output for the LineBlock starting with &lt;code class="docutils literal"&gt;.LP&lt;/code&gt;, which
would cancel the &lt;code class="docutils literal"&gt;.DS&lt;/code&gt; (display start) macro I want to use in the
.startpoem macro definition.  The &lt;code class="docutils literal"&gt;.LP&lt;/code&gt; would also reset the font family
in use to the default, another reason to avoid it. &lt;a class="footnote-reference brackets" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#lp" id="footnote-reference-1" role="doc-noteref"&gt;&lt;span class="fn-bracket"&gt;[&lt;/span&gt;1&lt;span class="fn-bracket"&gt;]&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The filter also converts the empty element that occurs in the line block
as a result of a blank line in the line block input into a RawBlock
that creates a blank line in the ms output, to show the division into
stanzas of the poem.&lt;/p&gt;
&lt;p&gt;Interestingly, the first Str elements in the each line in the content
of the line block preserved the leading spaces from the input as
Unicode NO-BREAK SPACE characters, preserving indentation of lines in
the line block.  Unfortunately, the width of those spaces alone is not
enough create a visually distinct indentation, so this filter changes
those Str elements into a RawInline that outputs a &lt;span class="app"&gt;groff&lt;/span&gt; horizfontal
movement whose width is based on the number of leading NO-BREAK SPACE
characters, and follow this with a new Str element that has the
leading NO-BREAK SPACE characters removed.&lt;/p&gt;
&lt;p&gt;Here is the Lua filter, &lt;span class="file"&gt;classify-rst-ms.lua&lt;/span&gt;:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code lua"&gt;&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-1" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-1" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-1"&gt;&lt;/a&gt;&lt;span class="n"&gt;onig&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"rex_onig"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- Need a regex package that understands UTF8.&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-2" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-2" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-2"&gt;&lt;/a&gt;&lt;span class="c1"&gt;-- text in LineBreak preserves leading spaces as Unicode NO-BREAK SPACE&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-3" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-3" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-3"&gt;&lt;/a&gt;&lt;span class="n"&gt;leading_nobreakspace_rx&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;onig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"^(&lt;/span&gt;&lt;span class="se"&gt;\u{a0}&lt;/span&gt;&lt;span class="s2"&gt;+)(.*)$"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"UTF8"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-4" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-4" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-4"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-5" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-5" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-5"&gt;&lt;/a&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;Div&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;element&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-6" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-6" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-6"&gt;&lt;/a&gt;  &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;classes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;find_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;matches&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-7" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-7" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-7"&gt;&lt;/a&gt;  &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;numPara&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-8" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-8" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-8"&gt;&lt;/a&gt;   &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-9" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-9" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-9"&gt;&lt;/a&gt;     &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;"[^%w]*"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-10" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-10" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-10"&gt;&lt;/a&gt;     &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;"poem"&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-11" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-11" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-11"&gt;&lt;/a&gt;        &lt;span class="n"&gt;element&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;walk_block&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-12" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-12" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-12"&gt;&lt;/a&gt;           &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-13" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-13" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-13"&gt;&lt;/a&gt;              &lt;span class="c1"&gt;-- Replace LineBlock element with a list of Plain elements&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-14" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-14" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-14"&gt;&lt;/a&gt;              &lt;span class="c1"&gt;-- containing the LineBlock's subelements.&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-15" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-15" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-15"&gt;&lt;/a&gt;              &lt;span class="n"&gt;LineBlock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;el&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-16" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-16" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-16"&gt;&lt;/a&gt;                 &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-17" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-17" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-17"&gt;&lt;/a&gt;                 &lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;subel&lt;/span&gt; &lt;span class="kr"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;ipairs&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;el&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-18" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-18" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-18"&gt;&lt;/a&gt;                    &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;subel&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-19" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-19" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-19"&gt;&lt;/a&gt;                       &lt;span class="c1"&gt;-- If subel is an empty table, output a raw empty line&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-20" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-20" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-20"&gt;&lt;/a&gt;                       &lt;span class="nb"&gt;table.insert&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RawBlock&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"ms"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\n\n&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-21" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-21" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-21"&gt;&lt;/a&gt;                    &lt;span class="kr"&gt;else&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-22" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-22" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-22"&gt;&lt;/a&gt;                       &lt;span class="c1"&gt;-- Check for leading NO-BREAK SPACE charaters&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-23" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-23" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-23"&gt;&lt;/a&gt;                       &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;onig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subel&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-24" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-24" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-24"&gt;&lt;/a&gt;                                                  &lt;span class="n"&gt;leading_nobreakspace_rx&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-25" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-25" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-25"&gt;&lt;/a&gt;                       &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-26" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-26" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-26"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- Replace the NO-BREAK SPACE characters with a raw&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-27" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-27" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-27"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- groff horizontal movement, because the&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-28" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-28" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-28"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- NO-BREAK SPACE characters are too narrow.&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-29" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-29" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-29"&gt;&lt;/a&gt;                          &lt;span class="nb"&gt;table.insert&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subel&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RawInline&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"ms"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;string.format&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s2"&gt;h'%dn'"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;utf8.len&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-30" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-30" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-30"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- Modify what was used to be the first item to just&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-31" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-31" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-31"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- include the trailing characters of the match.&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-32" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-32" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-32"&gt;&lt;/a&gt;                          &lt;span class="n"&gt;subel&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Str&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-33" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-33" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-33"&gt;&lt;/a&gt;                          &lt;span class="nb"&gt;table.insert&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Plain&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subel&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-34" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-34" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-34"&gt;&lt;/a&gt;                       &lt;span class="kr"&gt;else&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-35" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-35" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-35"&gt;&lt;/a&gt;                          &lt;span class="c1"&gt;-- Just put the subel in Plain element.&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-36" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-36" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-36"&gt;&lt;/a&gt;                          &lt;span class="nb"&gt;table.insert&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Plain&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subel&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-37" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-37" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-37"&gt;&lt;/a&gt;                       &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-38" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-38" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-38"&gt;&lt;/a&gt;                    &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-39" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-39" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-39"&gt;&lt;/a&gt;                 &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-40" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-40" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-40"&gt;&lt;/a&gt;                 &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-41" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-41" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-41"&gt;&lt;/a&gt;        &lt;span class="kr"&gt;end&lt;/span&gt; &lt;span class="p"&gt;})&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-42" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-42" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-42"&gt;&lt;/a&gt;     &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-43" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-43" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-43"&gt;&lt;/a&gt;     &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-44" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-44" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-44"&gt;&lt;/a&gt;        &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;".start"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="p"&gt;),&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-45" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-45" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-45"&gt;&lt;/a&gt;        &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-46" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-46" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-46"&gt;&lt;/a&gt;        &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;".stop"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-47" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-47" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-47"&gt;&lt;/a&gt;     &lt;span class="p"&gt;}&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-48" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-48" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-48"&gt;&lt;/a&gt;  &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-49" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-49" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-49"&gt;&lt;/a&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-50" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-50" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-50"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-51" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-51" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-51"&gt;&lt;/a&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;Span&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-52" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-52" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-52"&gt;&lt;/a&gt;  &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;classes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;find_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-53" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-53" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-53"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-54" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-54" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-54"&gt;&lt;/a&gt;  &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-55" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-55" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-55"&gt;&lt;/a&gt;     &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"[^%w]*"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-56" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-56" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-56"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-57" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-57" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-57"&gt;&lt;/a&gt;     &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-58" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-58" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-58"&gt;&lt;/a&gt;        &lt;span class="n"&gt;ms_inline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s2"&gt;*[start"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"]"&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-59" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-59" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-59"&gt;&lt;/a&gt;        &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-60" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-60" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-60"&gt;&lt;/a&gt;        &lt;span class="n"&gt;ms_inline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s2"&gt;*[stop"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"]"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-61" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-61" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-61"&gt;&lt;/a&gt;     &lt;span class="p"&gt;}&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-62" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-62" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-62"&gt;&lt;/a&gt;  &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-63" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-63" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-63"&gt;&lt;/a&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-64" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-64" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-64"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-65" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-65" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-65"&gt;&lt;/a&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-66" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-66" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-66"&gt;&lt;/a&gt; &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;"^%a+"&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-67" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-67" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-67"&gt;&lt;/a&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-68" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-68" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-68"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-69" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-69" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-69"&gt;&lt;/a&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;ms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;macro&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-70" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-70" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-70"&gt;&lt;/a&gt; &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RawBlock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;"ms"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;macro&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-71" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-71" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-71"&gt;&lt;/a&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-72" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-72" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-72"&gt;&lt;/a&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-73" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-73" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-73"&gt;&lt;/a&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;ms_inline&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;macro&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-74" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-74" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-74"&gt;&lt;/a&gt;  &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;pandoc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RawInline&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"ms"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;macro&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;annotation&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_d7a56000eea347d29a9fd0b471629dbf-75" name="rest_code_d7a56000eea347d29a9fd0b471629dbf-75" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_d7a56000eea347d29a9fd0b471629dbf-75"&gt;&lt;/a&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is the ReST source of the document, &lt;span class="file"&gt;poem-plus.rst&lt;/span&gt;:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code ReST"&gt;&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-1" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-1" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-1"&gt;&lt;/a&gt;Lua Filters For Massaging &lt;span class="s"&gt;``ms``&lt;/span&gt; Output
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-2" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-2" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-2"&gt;&lt;/a&gt;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-3" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-3" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-4" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-4" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-4"&gt;&lt;/a&gt;&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;raw&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; ms
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-5" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-5" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-5"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-6" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-6" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-6"&gt;&lt;/a&gt;   .ds startprogram \\f[CW]\\m[red]
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-7" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-7" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-7"&gt;&lt;/a&gt;   .ds stopprogram \\m[]\\fP
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-8" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-8" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-8"&gt;&lt;/a&gt;   .de startpoem
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-9" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-9" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-9"&gt;&lt;/a&gt;   .ds OLDFAM \\*[FAM]
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-10" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-10" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-10"&gt;&lt;/a&gt;   .ds FAM BM
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-11" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-11" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-11"&gt;&lt;/a&gt;   .DS I 3
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-12" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-12" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-12"&gt;&lt;/a&gt;&lt;span class="cp"&gt;   ..&lt;/span&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-13" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-13" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-13"&gt;&lt;/a&gt;&lt;span class="cp"&gt;   .de stoppoem&lt;/span&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-14" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-14" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-14"&gt;&lt;/a&gt;&lt;span class="cp"&gt;   .DE&lt;/span&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-15" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-15" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-15"&gt;&lt;/a&gt;&lt;span class="cp"&gt;   .ds FAM \\*[OLDFAM]&lt;/span&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-16" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-16" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-16"&gt;&lt;/a&gt;&lt;span class="cp"&gt;   ..&lt;/span&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-17" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-17" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-17"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-18" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-18" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-18"&gt;&lt;/a&gt;&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;role&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; program
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-19" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-19" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-19"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-20" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-20" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-20"&gt;&lt;/a&gt;This is a sentence.  This sentence talks about &lt;span class="na"&gt;:program:&lt;/span&gt;&lt;span class="nv"&gt;`pandoc`&lt;/span&gt;.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-21" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-21" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-21"&gt;&lt;/a&gt;This is
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-22" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-22" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-22"&gt;&lt;/a&gt;another sentence.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-23" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-23" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-23"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-24" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-24" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-24"&gt;&lt;/a&gt;&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;class&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; poem
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-25" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-25" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-25"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-26" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-26" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-26"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt; Some say the world will end in fire,
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-27" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-27" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-27"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    Some say in ice.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-28" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-28" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-28"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt; From what I've tasted of desire
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-29" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-29" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-29"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    I hold with those who favor fire.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-30" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-30" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-30"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt; But if it had to perish twice,
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-31" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-31" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-31"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    I think I know enough of hate
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-32" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-32" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-32"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    To say that for destruction ice
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-33" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-33" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-33"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    Is also great,
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-34" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-34" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-34"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt; And would suffice.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-35" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-35" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-35"&gt;&lt;/a&gt;   |
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-36" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-36" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-36"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt; And another line,
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-37" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-37" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-37"&gt;&lt;/a&gt;   &lt;span class="o"&gt;|&lt;/span&gt;    And an indented line.
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-38" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-38" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-38"&gt;&lt;/a&gt;
&lt;a id="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-39" name="rest_code_0f4dd3d29ca847dc943816a43dfb9cba-39" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_0f4dd3d29ca847dc943816a43dfb9cba-39"&gt;&lt;/a&gt;This is a final sentence.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And here is the ms output:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code groff"&gt;&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-1" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-1" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-1"&gt;&lt;/a&gt;.&lt;span class="k"&gt;SH&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-2" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-2" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-2"&gt;&lt;/a&gt;Lua Filters For Massaging &lt;span class="se"&gt;\f[CB]ms\f[B]&lt;/span&gt; Output
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-3" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-3" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-3"&gt;&lt;/a&gt;.&lt;span class="k"&gt;pdfhref&lt;/span&gt; &lt;span class="s"&gt;O&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="s2"&gt;"Lua Filters For Massaging ms Output"&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-4" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-4" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-4"&gt;&lt;/a&gt;.&lt;span class="k"&gt;pdfhref&lt;/span&gt; &lt;span class="s"&gt;M&lt;/span&gt; &lt;span class="s2"&gt;"lua-filters-for-massaging-ms-output"&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-5" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-5" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-5"&gt;&lt;/a&gt;.&lt;span class="k"&gt;ds&lt;/span&gt; &lt;span class="s"&gt;startprogram&lt;/span&gt; &lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;f[CW]\\m[red]&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-6" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-6" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-6"&gt;&lt;/a&gt;.&lt;span class="k"&gt;ds&lt;/span&gt; &lt;span class="s"&gt;stopprogram&lt;/span&gt; &lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;m[]\\fP&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-7" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-7" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-7"&gt;&lt;/a&gt;.&lt;span class="k"&gt;de&lt;/span&gt; &lt;span class="s"&gt;startpoem&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-8" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-8" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-8"&gt;&lt;/a&gt;.&lt;span class="k"&gt;ds&lt;/span&gt; &lt;span class="s"&gt;OLDFAM&lt;/span&gt; &lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;*[FAM]&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-9" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-9" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-9"&gt;&lt;/a&gt;.&lt;span class="k"&gt;ds&lt;/span&gt; &lt;span class="s"&gt;FAM&lt;/span&gt; &lt;span class="s"&gt;BM&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-10" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-10" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-10"&gt;&lt;/a&gt;.&lt;span class="k"&gt;DS&lt;/span&gt; &lt;span class="s"&gt;I&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-11" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-11" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-11"&gt;&lt;/a&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="s"&gt;.&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-12" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-12" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-12"&gt;&lt;/a&gt;.&lt;span class="k"&gt;de&lt;/span&gt; &lt;span class="s"&gt;stoppoem&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-13" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-13" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-13"&gt;&lt;/a&gt;.&lt;span class="k"&gt;DE&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-14" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-14" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-14"&gt;&lt;/a&gt;.&lt;span class="k"&gt;ds&lt;/span&gt; &lt;span class="s"&gt;FAM&lt;/span&gt; &lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;*[OLDFAM]&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-15" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-15" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-15"&gt;&lt;/a&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="s"&gt;.&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-16" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-16" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-16"&gt;&lt;/a&gt;.&lt;span class="k"&gt;LP&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-17" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-17" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-17"&gt;&lt;/a&gt;This is a sentence.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-18" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-18" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-18"&gt;&lt;/a&gt;This sentence talks about &lt;span class="se"&gt;\*[startprogram]pandoc\*[stopprogram]&lt;/span&gt;.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-19" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-19" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-19"&gt;&lt;/a&gt;This is
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-20" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-20" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-20"&gt;&lt;/a&gt;another sentence.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-21" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-21" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-21"&gt;&lt;/a&gt;.&lt;span class="k"&gt;startpoem&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-22" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-22" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-22"&gt;&lt;/a&gt;Some say the world will end in fire,
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-23" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-23" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-23"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'Some say in ice.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-24" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-24" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-24"&gt;&lt;/a&gt;From what I&lt;span class="se"&gt;\[&lt;/span&gt;aq]ve tasted of desire
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-25" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-25" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-25"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'I hold with those who favor fire.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-26" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-26" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-26"&gt;&lt;/a&gt;But if it had to perish twice,
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-27" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-27" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-27"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'I think I know enough of hate
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-28" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-28" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-28"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'To say that for destruction ice
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-29" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-29" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-29"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'Is also great,
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-30" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-30" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-30"&gt;&lt;/a&gt;And would suffice.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-31" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-31" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-31"&gt;&lt;/a&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-32" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-32" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-32"&gt;&lt;/a&gt;And another line,
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-33" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-33" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-33"&gt;&lt;/a&gt;&lt;span class="se"&gt;\h&lt;/span&gt;'3n'And an indented line.
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-34" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-34" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-34"&gt;&lt;/a&gt;.&lt;span class="k"&gt;stoppoem&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-35" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-35" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-35"&gt;&lt;/a&gt;.&lt;span class="k"&gt;LP&lt;/span&gt;
&lt;a id="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-36" name="rest_code_9aca7e0f0ab1490d80af0b671f0559d1-36" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_9aca7e0f0ab1490d80af0b671f0559d1-36"&gt;&lt;/a&gt;This is a final sentence.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The command to produce the ms output is:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code bash"&gt;&lt;a id="rest_code_316a58b86c874e41b75bc562e8387152-1" name="rest_code_316a58b86c874e41b75bc562e8387152-1" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_316a58b86c874e41b75bc562e8387152-1"&gt;&lt;/a&gt;pandoc&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;rst&lt;span class="w"&gt; &lt;/span&gt;-t&lt;span class="w"&gt; &lt;/span&gt;ms&lt;span class="w"&gt; &lt;/span&gt;--lua-filter&lt;span class="w"&gt; &lt;/span&gt;classify-rst-ms.lua&lt;span class="w"&gt; &lt;/span&gt;--wrap&lt;span class="o"&gt;=&lt;/span&gt;preserve&lt;span class="w"&gt; &lt;/span&gt;poem-plus.rst&lt;span class="w"&gt; &lt;/span&gt;--output&lt;span class="o"&gt;=&lt;/span&gt;poem-plus-rst.ms
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and the command to produce a PDF is:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code bash"&gt;&lt;a id="rest_code_7e7a49c659494c09ae73ebd75383748c-1" name="rest_code_7e7a49c659494c09ae73ebd75383748c-1" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#rest_code_7e7a49c659494c09ae73ebd75383748c-1"&gt;&lt;/a&gt;pandoc&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;rst&lt;span class="w"&gt; &lt;/span&gt;-t&lt;span class="w"&gt; &lt;/span&gt;ms&lt;span class="w"&gt; &lt;/span&gt;--lua-filter&lt;span class="w"&gt; &lt;/span&gt;classify-rst-ms.lua&lt;span class="w"&gt; &lt;/span&gt;--wrap&lt;span class="o"&gt;=&lt;/span&gt;preserve&lt;span class="w"&gt; &lt;/span&gt;poem-plus.rst&lt;span class="w"&gt; &lt;/span&gt;--output&lt;span class="o"&gt;=&lt;/span&gt;poem-plus-rst.ms.pdf
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a class="reference external" href="https://tkurtbond.github.io/poem-plus-rst.ms.pdf"&gt;Here&lt;/a&gt; is the output PDF.&lt;/p&gt;
&lt;p&gt;Being able to rewrite the tree and insert RawBlocks and RawInlines is
really powerful when it comes to customizing output for particular
output formats.&lt;/p&gt;
&lt;p&gt;I hope this example is useful for others like me just learning to use
Lua filters.&lt;/p&gt;
&lt;aside class="footnote-list brackets"&gt;
&lt;aside class="footnote brackets" id="lp" role="doc-footnote"&gt;
&lt;span class="label"&gt;&lt;span class="fn-bracket"&gt;[&lt;/span&gt;&lt;a role="doc-backlink" href="https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/#footnote-reference-1"&gt;1&lt;/a&gt;&lt;span class="fn-bracket"&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;The &lt;code class="docutils literal"&gt;.LP&lt;/code&gt; macro in the &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;-ms&lt;/span&gt;&lt;/code&gt; macros resets a lot of
things back to the default when it is used, so if you want the custom
&lt;span class="app"&gt;groff&lt;/span&gt; setting from your user defined macros to continue from the
start to the end you can't allow the use of &lt;code class="docutils literal"&gt;.LP&lt;/code&gt; between the
&lt;code class="docutils literal"&gt;.start&amp;lt;class&amp;gt;&lt;/code&gt; and &lt;code class="docutils literal"&gt;.stop&amp;lt;class&amp;gt;&lt;/code&gt; macros.&lt;/p&gt;
&lt;/aside&gt;
&lt;/aside&gt;</description><category>groff ms macros</category><category>lua filters</category><category>pandoc</category><category>pandoc-discuss</category><category>pdf</category><category>restructuredtext</category><guid>https://tkurtbond.github.io/posts/2020/05/03/customizing-pandoc-ms-output-with-a-lua-filter/</guid><pubDate>Sun, 03 May 2020 05:01:53 GMT</pubDate></item></channel></rss>